<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aaa.fresh.mapper.TakeStockMapper">
    <resultMap id="stockTakingRecordDataMap" type="StockTakingRecordData">
        <result column="id" jdbcType="VARCHAR" property="id" />
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="produce" jdbcType="VARCHAR" property="produce" />
        <result column="stock_lot_number" jdbcType="VARCHAR" property="stockLotNumber" />
        <result column="measure_unit" jdbcType="VARCHAR" property="measureUnit" />
        <result column="inventory" jdbcType="VARCHAR" property="inventory" />
        <result column="inventory_quantity" jdbcType="INTEGER" property="inventoryQuantity" />
        <result column="stock_taking_quantity" jdbcType="INTEGER" property="stockTakingQuantity" />
        <result column="stock_taking_diff" jdbcType="INTEGER" property="stockTakingDiff" />
        <result column="stock_taking_result" jdbcType="VARCHAR" property="stockTakingResult" />
        <result column="operator" jdbcType="VARCHAR" property="operator" />
        <result column="comment" jdbcType="VARCHAR" property="comment" />
        <result column="create_time" jdbcType="DATE" property="createTime" />
        <result column="stock_taking" jdbcType="VARCHAR" property="stockTaking" />
        <result column="version" jdbcType="INTEGER" property="version" />
    </resultMap>

    <sql id="sel">
        <if test="id != null and id != ''">
            and ID = #{id}
        </if>
        <if test="name != null and name != ''">
            and NAME = #{name}
        </if>
        <if test="produce != null and produce != ''">
            and PRODUCE = #{produce}
        </if>
        <if test="measureUnit != null and measureUnit != ''">
            and MEASURE_UNIT = #{measureUnit}
        </if>
        <if test="inventory != null and inventory != ''">
            and INVENTORY = #{inventory}
        </if>
        <if test="stockTakingResult != null and stockTakingResult != ''">
            and STOCK_TAKING_RESULT = #{stockTakingResult}
        </if>
        <if test="operator != null and operator != ''">
            and OPERATOR = #{operator}
        </if>
        <if test="comment != null and comment != ''">
            and COMMENT = #{comment}
        </if>
    </sql>
    <!--//分页查询-->
    <select id="getTotal" parameterType="StockTakingRecordData" resultType="java.lang.Long">
        SELECT COUNT(*) FROM supplychain.stock_taking_record_data
        <where>
            <include refid="sel"/>
        </where>
    </select>

    <!--查询所有 产品  计量单位  库存  实物盘点结果  查询根据商品信息查询出库存编号以及库存-->
    <select id="selAllTakeStock" parameterType="StockTakingRecordData" resultMap="stockTakingRecordDataMap">
        SELECT a.ID, a.NAME, b.NAME PRODUCE,  c.NAME MEASURE_UNIT,  INVENTORY, INVENTORY_QUANTITY, a.STOCK_TAKING_QUANTITY, a.STOCK_TAKING_DIFF, e.NAME STOCK_TAKING_RESULT, a.OPERATOR, a.COMMENT, a.CREATE_TIME, f.NAME STOCK_TAKING
            FROM supplychain.stock_taking_record_data a,
            supplychain.product_data b,
            supplychain.measure_unit_data c,
            supplychain.stock_taking_result_data e,
            supplychain.stock_taking_data f
            WHERE a.PRODUCE = b.ID AND
            a.MEASURE_UNIT = c.ID AND
            a.STOCK_TAKING_RESULT = e.ID and
            f.ID = a.STOCK_TAKING and
            a.STOCK_TAKING = #{stockTaking}
            <include refid="sel"/>
            <if test="page != null and size != null">
                limit #{page},#{size}
            </if>

    </select>

    <!--查询单个-->
    <select id="selOneTakeStock" resultMap="stockTakingRecordDataMap" parameterType="String">
        SELECT a.ID, a.NAME, b.NAME PRODUCE,  c.NAME MEASURE_UNIT, d.ID INVENTORY, d.QUANTITY INVENTORY_QUANTITY, a.STOCK_TAKING_QUANTITY, a.STOCK_TAKING_DIFF, e.NAME STOCK_TAKING_RESULT, a.OPERATOR, a.COMMENT, a.CREATE_TIME, a.STOCK_TAKING
        FROM supplychain.stock_taking_record_data a,
             supplychain.product_data b,
             supplychain.measure_unit_data c,
             supplychain.inventory_data d,
             supplychain.stock_taking_result_data e
        WHERE a.PRODUCE = b.ID AND
            a.MEASURE_UNIT = c.ID AND
            a.INVENTORY = d.ID AND
            a.STOCK_TAKING_RESULT = e.ID AND
              a.ID = #{id}
    </select>

    <!--删除-->
    <delete id="deleteTakeStock" parameterType="String">
        DELETE FROM supplychain.stock_taking_record_data
        WHERE ID = #{id}
    </delete>

    <!--修改 可修改： 名称  产品  计量单位  库存  实物盘点结果  操作员  实物盘点计划 备注-->
    <update id="updTakeStock" parameterType="StockTakingRecordData">
        UPDATE supplychain.stock_taking_record_data
        <set>
            <if test="name != null and name != ''">
                NAME = #{name},
            </if>
            <if test="produce != null and produce != ''">
                PRODUCE = #{produce},
            </if>
            <if test="measureUnit != null and measureUnit != ''">
                MEASURE_UNIT = #{measureUnit},
            </if>
            <if test="inventory != null and inventory != ''">
                INVENTORY = #{inventory},
            </if>
            <if test="stockTakingQuantity != null stockTakingQuantity != ''">
                STOCK_TAKING_QUANTITY = #{stockTakingQuantity},
            </if>
            <if test="stockTakingDiff != null and stockTakingDiff != ''">
                STOCK_TAKING_DIFF = #{stockTakingDiff},
            </if>
            <if test="stockTakingResult != null and stockTakingResult != ''">
                STOCK_TAKING_RESULT = #{stockTakingResult},
            </if>
            <if test="operator != null and operator != ''">
                OPERATOR = #{operator},
            </if>
            <if test="comment != null and comment != ''">
                COMMENT = #{comment},
            </if>
            <if test="stockTaking != null and stockTaking != ''">
                STOCK_TAKING = #{stockTaking},
            </if>
        </set>
        WHERE ID=#{id}
    </update>

    <!--添加  只需添加一个商品的信息，就可以添加一个库存编号，以及库存-->
    <insert id="addTakeStock" parameterType="StockTakingRecordData">
        INSERT INTO supplychain.stock_taking_record_data
        (ID, NAME, PRODUCE,  MEASURE_UNIT, INVENTORY, INVENTORY_QUANTITY, STOCK_TAKING_QUANTITY, STOCK_TAKING_DIFF, STOCK_TAKING_RESULT, OPERATOR, COMMENT, CREATE_TIME, STOCK_TAKING, VERSION)
        VALUES(#{id}, #{name}, #{produce},  #{measureUnit}, #{inventory}, #{inventoryQuantity}, #{stockTakingQuantity}, #{stockTakingDiff}, #{stockTakingResult}, #{operator}, #{comment}, NOW(), #{stockTaking}, 1)
    </insert>

</mapper>